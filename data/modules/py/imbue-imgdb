import sqlite3

def actualizar_imbue_img_urls(db_path="data/bontar_data.db"):
    # Conectar a la base de datos
    conn = sqlite3.connect(db_path)
    cursor = conn.cursor()
    
    # Consulta para obtener el id y el nombre de cada imbuement
    cursor.execute("SELECT id, imbue_name FROM imbues")
    registros = cursor.fetchall()
    
    # URL base para las imágenes de imbuements
    url_base = "https://raw.githubusercontent.com/Andreesb/alystarpedia-data/main/assets/imbuements/"
    
    for reg in registros:
        imbue_id, imbue_name = reg
        if imbue_name:
            # Reemplazar espacios por %20
            imbue_name_url = imbue_name.replace(" ", "%20").lower()
            nueva_url = f"{url_base}{imbue_name_url}.png"
            
            # Actualizar el registro
            cursor.execute("UPDATE imbues SET imbue_img_url = ? WHERE id = ?", (nueva_url, imbue_id))
            print(f"Actualizado id {imbue_id}: {nueva_url}")
    
    # Confirmar los cambios y cerrar la conexión
    conn.commit()
    conn.close()
    print("Actualización completada.")

if __name__ == "__main__":
    actualizar_imbue_img_urls()
